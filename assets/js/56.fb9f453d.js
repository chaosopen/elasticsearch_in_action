(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{372:function(s,t,a){"use strict";a.r(t);var r=a(14),n=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_6-1-查询相关操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-查询相关操作"}},[s._v("#")]),s._v(" 6.1 查询相关操作")]),s._v(" "),t("h2",{attrs:{id:"_6-1-1-深分页游标查询-scroll"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-1-深分页游标查询-scroll"}},[s._v("#")]),s._v(" 6.1.1 深分页游标查询 scroll")]),s._v(" "),t("p",[s._v("改动index.max_result_window参数值的大小，只能解决一时的问题，当索引的数据量持续增长时，在查询全量数据时还是会出现问题。而且会增加ES服务器内存大结果集消耗完的风险。采用"),t("code",[s._v("scroll")]),s._v("可以更高效的请求大量数据集。")]),s._v(" "),t("h3",{attrs:{id:"_1-查询命令增加scroll-1m参数-说明采用游标查询-保持游标窗口一分钟。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-查询命令增加scroll-1m参数-说明采用游标查询-保持游标窗口一分钟。"}},[s._v("#")]),s._v(" 1. 查询命令增加"),t("code",[s._v("scroll=1m")]),s._v("参数，说明采用游标查询，保持游标窗口一分钟。")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("GET product_index/_search?scroll=1m\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"size"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("查询结果会多一个参数："),t("code",[s._v("_scroll_id")]),s._v("游标id。")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_scroll_id"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FGluY2x1ZGVfY29udGV4dF91dWlkDXF1ZXJ5QW5kRmV0Y2gBFFE3VXkyNHNCcnhYTHFjTnZBamU1AAAAAAAB-ZQWQkc5RkdrNFBUSldMenoxX3oxd2d2dw=="')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"took"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"_2-翻页带着游标id查询-每次查询数量和上次size一样。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-翻页带着游标id查询-每次查询数量和上次size一样。"}},[s._v("#")]),s._v(" 2. 翻页带着游标id查询，每次查询数量和上次size一样。")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("GET /_search/scroll\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scroll"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1m"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scroll_id"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FGluY2x1ZGVfY29udGV4dF91dWlkDXF1ZXJ5QW5kRmV0Y2gBFFE3VXkyNHNCcnhYTHFjTnZBamU1AAAAAAAB-ZQWQkc5RkdrNFBUSldMenoxX3oxd2d2dw=="')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("多次根据scroll_id游标查询，直到没有数据返回则结束查询。采用游标查询索引全量数据，更安全高效，限制了单次对内存的消耗。")])])}),[],!1,null,null,null);t.default=n.exports}}]);